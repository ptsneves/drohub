@using Dropbox.Api.Files
@using Dropbox.Api.Stone

@model DroHub.Areas.DHub.Models.Device
@{
    ViewData["Title"] = "Gallery";
    List<Tuple<string, FileMetadata>> deviceRepositoryItems = ViewData["DeviceGalleryItems"] as List<Tuple<string, FileMetadata>>;
}
<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        Devices
        <small>Gallery</small>
    </h1>
    <ol class="breadcrumb">
        <li><a asp-area="DHub" asp-controller="Devices" asp-action="" title="Back to devices list"><i class="fa fa-camera"></i> Devices</a></li>
        <li class="active">Gallery</li>
    </ol>
</section>
<!-- /Content Header (Page header) -->
<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li role="presentation">
                                <a asp-area="DHub" asp-controller="Devices" asp-route-id="@Model.Id" asp-action="Camera" title="View device camera">Camera</a>
                            </li>
                            <li role="presentation" class="active">
                                <a href="#">Gallery</a>
                            </li>
                            <li role="presentation">
                                <a asp-area="DHub" asp-controller="Devices" asp-route-id="@Model.Id" asp-action="Data" title="View device data">Data</a>
                            </li>
                            <li class="pull-right header">
                                <input type="submit" class="pull-right btn btn-sm btn-danger" value="Disconnect repository"
                                       form="disconnect-form" />
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="box-body">
                    <table class="table table-bordered table-hover ui-helper-center">
                        <thead>
                            <tr>
                                <th>Thumbnail</th>
                                <th>DateTime</th>
                                <th>File</th>
                                <th>Size (bytes)</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var file in deviceRepositoryItems)
                            {
                                <tr>
                                    <td class="ui-helper-center">
                                        <img src="data:image/jpg;charset=utf-8;base64, @file.Item1" />
                                    </td>
                                    <td class="ui-helper-center">
                                        @file.Item2.MediaInfo.AsMetadata.Value.TimeTaken
                                    </td>
                                    <td class="ui-helper-center">
                                        @file.Item2.Name
                                    </td>
                                    <td class="ui-helper-center">
                                        @file.Item2.Size
                                    </td>
                                    <td class="ui-helper-center">
                                        @{
                                            var parms = new Dictionary<string, string> {
                                                { "id", Model.Id.ToString() },
                                                { "DropboxFolderPath", file.Item2.AsFile.PathDisplay },
                                                { "DropboxFileName", file.Item2.Name},
                                                { "DownloadFolderPath", "C:\\Users\\fsamu\\Downloads"},
                                                { "DownloadFileName", file.Item2.Name}
                                            };
                                        }
                                        <a asp-area="DHub" asp-controller="DeviceRepository" asp-action="DownloadFile"
                                           asp-all-route-data="@parms" class="btn btn-info btn-xs" title="Download File"><i class="fa fa-download"></i></a>
                                        @*<a asp-area="DHub" asp-controller="DeviceRepository" asp-action="DeleteFile"
                                            asp-all-route-data="@parms" class="btn btn-danger btn-xs" title="Delete File"><i class="fa fa-trash"></i></a>*@
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="box-footer">
                    <a asp-area="DHub" asp-controller="Devices" asp-action="" class="btn btn-primary" title="Back to devices list">Back to list</a>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- /Main content -->
@using (Html.BeginForm("Disconnect", "DeviceRepository", new { id = @Model.Id }, FormMethod.Post, true, new { id = "disconnect-form" }))
{
    @Html.AntiForgeryToken();
}

